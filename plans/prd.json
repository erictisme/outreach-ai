{
  "project": "outreach-ai-v3",
  "description": "B2B outreach tool: Project Setup → Context Extraction → Company Discovery → Contact Discovery (free→paid) → Enriched Data Table → Email Generation with Conversations",
  "tech_stack": {
    "framework": "Next.js 14 App Router",
    "database": "Supabase (Postgres)",
    "styling": "Tailwind CSS",
    "apis": ["Apollo (contacts + emails)", "Gemini (extraction + emails)", "Perplexity (web search enrichment)"],
    "auth": "None for MVP, multi-user later"
  },
  "existing_code": {
    "api_routes": ["/api/extract", "/api/generate-list", "/api/find-contacts-apollo", "/api/write-emails", "/api/refine-email", "/api/enrich-companies", "/api/draft-response"],
    "components": ["ResultsTable", "EmailEditor", "ConversationThread", "ContextInput", "SchemaEditor", "ApiKeyModal", "Toast"],
    "storage": "Supabase (projects, companies, contacts, emails tables) + localStorage for workflow state"
  },
  "features": [
    {
      "id": "F1",
      "name": "Project Setup Page",
      "priority": 1,
      "passes": true,
      "description": "First step: collect project objective, context, file uploads, and optional email templates",
      "steps": [
        "Update src/app/project/[id]/workflow/page.tsx Step 1 (Context)",
        "Add objective dropdown: Find suppliers, Find distributors, Find companies to work with, Find sales prospects, Custom",
        "Add company/client name input field",
        "Add rich text context field for user to describe what they're trying to achieve",
        "Add file upload for collateral (PDFs, pitch decks, case studies) - use Supabase storage",
        "Add optional email template input field",
        "Store all inputs and trigger extraction on 'Next'"
      ],
      "acceptance": "User can enter objective, company name, context, upload files, and optionally add email templates"
    },
    {
      "id": "F2",
      "name": "Context Extraction & Editable Fields",
      "priority": 2,
      "passes": true,
      "description": "LLM extracts structured data from project context, displays as editable fields, saves to project context",
      "steps": [
        "After Step 1 submission, call /api/extract with all context + uploaded files",
        "Display extracted data as editable fields: Client name, Target seniority, Target segments (3-4), Key roles, Key objective",
        "Add target seniority dropdown: C-suite, Director, Manager, etc.",
        "Add key roles multi-select or chips: CEO, Innovation Manager, Procurement, Buyer, etc.",
        "Add 'Save Context' button that persists to Supabase project.context field",
        "Show 'Do you have companies already?' choice: 'No, generate with AI' vs 'Yes, I have companies'",
        "If user has companies, show paste/import options and skip segment-based generation"
      ],
      "acceptance": "Extracted context is editable, saves to project, shows company source choice"
    },
    {
      "id": "F3",
      "name": "Segment-based Company Discovery",
      "priority": 3,
      "passes": true,
      "description": "Show target segments with count inputs, generate or import companies",
      "steps": [
        "Display 3-4 target segments as cards (from extracted context)",
        "Each segment card has editable count input: 'How many companies to find?' with +/- buttons",
        "Add 'Generate Companies' button that calls /api/generate-list with segment counts",
        "Add 'I have companies' flow with paste textarea and CSV import",
        "For manual entry/paste, use LLM to parse and fill columns (name, type, website, description)",
        "Show generated companies as clickable cards for selection (not small checkboxes)",
        "Clicking card toggles selection state with visual feedback (border color, checkmark)",
        "Add 'Add Company Manually' input that uses LLM to fill columns",
        "Selected companies proceed to enrichment"
      ],
      "acceptance": "Segment cards with counts work, companies generated or imported, card selection works"
    },
    {
      "id": "F4",
      "name": "Company Enrichment with Web Search",
      "priority": 4,
      "passes": false,
      "description": "Enrich selected companies with web search to reduce hallucination",
      "steps": [
        "Create /api/enrich-company-web endpoint using Perplexity API",
        "After company selection, show 'Enrich with Web Search' button",
        "For each selected company, search web for: website, description, industry, employee count",
        "Display enrichment progress bar",
        "Show enriched data in editable table",
        "User can manually edit any field",
        "Mark enrichment source: 'web_search' or 'ai_generated' or 'manual'"
      ],
      "acceptance": "Web search enrichment works via Perplexity, reduces hallucination, source tracked"
    },
    {
      "id": "F5",
      "name": "Two-phase Contact Discovery",
      "priority": 5,
      "passes": false,
      "description": "Free contact discovery (name, role, LinkedIn) → Paid email enrichment with cost estimate",
      "steps": [
        "Create /api/find-contacts-free endpoint (LinkedIn scraping or free Apollo tier)",
        "Phase 1: Show contacts without emails - Name, Role, LinkedIn, Company",
        "Display contacts as selectable cards or table rows with checkboxes",
        "User ticks contacts to select for email enrichment",
        "Show running count of selected contacts",
        "Calculate and display cost estimate before 'Find Emails' button",
        "Option to use own Apollo API key (extend ApiKeyModal)",
        "Phase 2: On 'Find Emails' click, call Apollo enrichment for selected contacts only",
        "Show cost confirmation modal before proceeding"
      ],
      "acceptance": "Free contacts shown first, user selects, sees cost estimate, paid enrichment for selected only"
    },
    {
      "id": "F6",
      "name": "Enriched Data Table with Status Tracking",
      "priority": 6,
      "passes": false,
      "description": "Key page showing all enriched contacts with status, date sent, and follow-up alerts",
      "steps": [
        "Create comprehensive data table with all contact + company info",
        "Add Status column with dropdown: Not Contacted, Email Sent, Accepted, Rejected, Meeting Secured, Done/Closed",
        "Add Date Sent column with date picker",
        "Add visual indicator (color change) for contacts needing follow-up (3+ days past Email Sent, no status update)",
        "Add copy buttons: Copy all as TSV, Copy emails only, Copy individual row",
        "Make table sortable by any column",
        "Add filter/search functionality",
        "Auto-save status changes to Supabase",
        "This is THE KEY PAGE - data cannot be lost"
      ],
      "acceptance": "Table shows all data, status tracking works, 3-day follow-up alerts show, copy buttons work"
    },
    {
      "id": "F7",
      "name": "Email Generation with Master Prompt",
      "priority": 7,
      "passes": false,
      "description": "Generate emails with master prompt affecting all, plus individual prompt per contact",
      "steps": [
        "At top: Master Prompt textarea that affects ALL emails below",
        "Add warning modal when master prompt is about to run (affects all emails)",
        "For each contact, show: Name, Company, Email Subject [Copy], Email Body [Copy]",
        "Add individual prompt textarea per contact for customization",
        "Generate button regenerates that contact's email with individual prompt",
        "Include 'Regenerate All' button that uses master prompt",
        "Emails should be plain text, easy to copy-paste into email client"
      ],
      "acceptance": "Master prompt works with warning, individual prompts work, copy buttons work"
    },
    {
      "id": "F8",
      "name": "Conversation Mode with Follow-ups",
      "priority": 8,
      "passes": false,
      "description": "Enter replies from contacts, generate follow-up emails, track conversation thread",
      "steps": [
        "Add 'Enter Conversation' button per contact",
        "Opens conversation view showing: Initial email sent, space to paste received reply",
        "User pastes reply from contact",
        "LLM generates suggested response (plain text, easy to copy)",
        "If no reply received, show 'Generate Follow-up' button",
        "Generate appropriate follow-up email based on time elapsed",
        "Show full conversation thread history",
        "Update contact status based on conversation (e.g., replied → Meeting Secured)"
      ],
      "acceptance": "Can enter replies, generates follow-ups, tracks conversation history"
    },
    {
      "id": "F9",
      "name": "Incremental Company Addition",
      "priority": 9,
      "passes": false,
      "description": "Add new companies anytime, goes through same enrichment flow, appends to main table",
      "steps": [
        "Add 'Add More Companies' button on main data table",
        "Opens mini-flow: paste/import companies OR generate from segments",
        "New companies go through same enrichment + contact discovery flow",
        "Append enriched contacts to main table (not replace)",
        "Maintain existing status/conversation data for previous contacts",
        "Show 'newly added' indicator for recent additions"
      ],
      "acceptance": "Can add companies anytime, they append to existing data, flow is consistent"
    },
    {
      "id": "F10",
      "name": "API Key Management UI",
      "priority": 10,
      "passes": false,
      "description": "Manage Apollo and Perplexity API keys with clear UI",
      "steps": [
        "Extend existing ApiKeyModal to support multiple services",
        "Add Perplexity API key input for web search enrichment",
        "Show key status indicators (set/not set) in header or settings",
        "Add settings page accessible from anywhere",
        "Clear instructions on where to get each API key",
        "Validate API keys on entry if possible"
      ],
      "acceptance": "Can manage Apollo + Perplexity keys, status visible, instructions clear"
    }
  ],
  "phases": {
    "phase1": {
      "name": "Core Workflow",
      "features": ["F1", "F2", "F3", "F4", "F5", "F6"],
      "description": "Essential flow from project setup to enriched data table"
    },
    "phase2": {
      "name": "Email & Conversation",
      "features": ["F7", "F8"],
      "description": "Email generation with master prompts and conversation tracking"
    },
    "phase3": {
      "name": "Polish",
      "features": ["F9", "F10"],
      "description": "Incremental additions and API key management"
    }
  }
}
