{
  "project": "outreach-v2",
  "description": "Table-centric B2B outreach tool. Main table (right) + collapsible wizard panel (left). One page per project.",
  "architecture": "Two-column layout: WizardPanel (collapsible accordion) + DataTable (source of truth)",
  "tech_stack": {
    "framework": "Next.js 14 App Router",
    "database": "Supabase (existing schema)",
    "styling": "Tailwind CSS",
    "state": "React useState + Supabase for persistence"
  },
  "existing_apis_to_use": [
    "/api/extract",
    "/api/generate-list",
    "/api/enrich-companies",
    "/api/find-contacts-apollo",
    "/api/write-emails",
    "/api/refine-email",
    "/api/draft-response"
  ],
  "features": [
    {
      "id": "F1",
      "name": "Project page shell",
      "priority": 1,
      "passes": true,
      "description": "Create the main project page with two-column layout",
      "steps": [
        "Create src/app/project/[id]/page.tsx as 'use client' component",
        "Add two-column flex layout: left panel (w-80, collapsible) + right main area (flex-1)",
        "Left panel: placeholder div with 'Wizard Panel' text",
        "Right area: placeholder div with 'Data Table' text",
        "Add collapse/expand button for left panel (ChevronLeft/Right icon)",
        "Load project from Supabase by ID, show loading spinner",
        "Show error state if project not found",
        "Header with project name and 'Back to Projects' link"
      ],
      "acceptance": "Page loads with two-column layout, panel collapses/expands"
    },
    {
      "id": "F2",
      "name": "Data table component",
      "priority": 2,
      "passes": true,
      "description": "Create the main unified data table that shows all enriched data",
      "steps": [
        "Create src/components/DataTable.tsx",
        "Columns: Company, Contact, Title, Email, Status, Date Sent, Actions",
        "Accept data prop: array of rows with company+contact+email info",
        "Render table with Tailwind styling (border, hover states)",
        "Empty state: 'No data yet. Use the wizard to add companies and contacts.'",
        "Add header row with column names",
        "Each row shows: company name, contact name, title, email (or '-'), status dropdown, date picker"
      ],
      "acceptance": "Table renders with columns, shows empty state when no data"
    },
    {
      "id": "F3",
      "name": "Status dropdown inline edit",
      "priority": 3,
      "passes": true,
      "description": "Add inline status editing to table rows",
      "steps": [
        "Create src/components/StatusDropdown.tsx",
        "Status options: Not Contacted, Email Sent, Replied, Meeting Secured, Rejected, Closed",
        "Dropdown styled as inline select (no border until hover)",
        "Color coding: Not Contacted (gray), Email Sent (blue), Replied (green), Meeting Secured (purple), Rejected (red), Closed (dark)",
        "onChange calls parent handler to update status",
        "Integrate into DataTable rows"
      ],
      "acceptance": "Can change status inline, colors update immediately"
    },
    {
      "id": "F4",
      "name": "Date sent column with follow-up alert",
      "priority": 4,
      "passes": false,
      "description": "Add date sent picker and 3-day follow-up visual indicator",
      "steps": [
        "Add date picker input in Date Sent column (type='date')",
        "Calculate days since date sent",
        "If status is 'Email Sent' AND days >= 3: highlight row with amber/yellow background",
        "Add small badge or icon indicating 'Follow-up needed'",
        "Clear highlight when status changes to Replied/Meeting Secured/Closed",
        "Save date to Supabase on change"
      ],
      "acceptance": "Date picker works, rows highlight after 3 days of Email Sent status"
    },
    {
      "id": "F5",
      "name": "Copy buttons for table",
      "priority": 5,
      "passes": false,
      "description": "Add copy functionality for TSV and emails",
      "steps": [
        "Add button bar above table: [Copy as TSV] [Copy Emails Only] [Export CSV]",
        "Copy as TSV: copies all visible rows as tab-separated values",
        "Copy Emails Only: copies just the email addresses, one per line",
        "Export CSV: downloads as .csv file",
        "Show toast notification on successful copy",
        "Use navigator.clipboard.writeText for copy"
      ],
      "acceptance": "All three copy/export buttons work, toast shows on success"
    },
    {
      "id": "F6",
      "name": "Wizard panel accordion shell",
      "priority": 6,
      "passes": false,
      "description": "Create collapsible accordion for wizard steps",
      "steps": [
        "Create src/components/WizardPanel.tsx",
        "5 accordion sections: Setup, Context, Companies, Contacts, Emails",
        "Each section has header (clickable) + content (collapsible)",
        "Only one section expanded at a time (accordion behavior)",
        "Section header shows: step number, title, completion indicator (checkmark if done)",
        "Smooth expand/collapse animation",
        "Pass expanded step and onStepChange as props"
      ],
      "acceptance": "Accordion expands/collapses, only one open at a time"
    },
    {
      "id": "F7",
      "name": "Step 1: Setup form",
      "priority": 7,
      "passes": false,
      "description": "Implement the Setup wizard step",
      "steps": [
        "Create src/components/wizard/SetupStep.tsx",
        "Objective dropdown: Sales Prospects, Find Distributors, Find Suppliers, Find Partners, Custom",
        "If Custom selected, show text input for custom objective",
        "Company/Client name text input",
        "Context textarea (large, multi-line) for project description",
        "File upload area for PDFs/docs (store in Supabase storage or just extract text)",
        "Optional email template textarea",
        "Save button that stores to project and calls /api/extract",
        "Show loading state during extraction"
      ],
      "acceptance": "Form saves to Supabase, triggers extraction API"
    },
    {
      "id": "F8",
      "name": "Step 2: Context review form",
      "priority": 8,
      "passes": false,
      "description": "Display and edit extracted context",
      "steps": [
        "Create src/components/wizard/ContextStep.tsx",
        "Load extracted context from project.schema_config.extractedContext",
        "Editable fields: Client Name (input), Product (input), Value Proposition (textarea)",
        "Target Market (input), Target Seniority (dropdown: C-suite, Director, Manager, Any)",
        "Target Roles as tag/chip input (add/remove roles like CEO, CFO, Buyer)",
        "Target Segments as editable list (from extraction)",
        "Save button persists changes to Supabase",
        "Show 'Re-extract' button to call /api/extract again"
      ],
      "acceptance": "Extracted fields are editable and save to Supabase"
    },
    {
      "id": "F9",
      "name": "Step 3: Companies - segment cards",
      "priority": 9,
      "passes": false,
      "description": "Show segments with count inputs for company generation",
      "steps": [
        "Create src/components/wizard/CompaniesStep.tsx",
        "Display extracted segments as cards (from context.segments)",
        "Each card shows: segment name, description, count input (number, default 5)",
        "Plus/minus buttons to adjust count",
        "Total count displayed at bottom",
        "Two main buttons: 'Generate Companies' and 'I have companies'",
        "'Generate' calls /api/generate-list with segments and counts",
        "'I have companies' reveals paste textarea and CSV upload"
      ],
      "acceptance": "Segment cards display with adjustable counts"
    },
    {
      "id": "F10",
      "name": "Step 3: Companies - generate flow",
      "priority": 10,
      "passes": false,
      "description": "Implement company generation from segments",
      "steps": [
        "On 'Generate Companies' click, show loading spinner",
        "Call /api/generate-list with context and segment counts",
        "Display results as selectable cards (company name, type, description)",
        "Click card to select/deselect (visual toggle: border highlight, checkmark)",
        "Show count: 'X of Y selected'",
        "Add 'Enrich Selected' button that calls /api/enrich-companies",
        "After enrichment, add companies to main DataTable",
        "Save companies to Supabase"
      ],
      "acceptance": "Companies generate, can select, enrich adds to table"
    },
    {
      "id": "F11",
      "name": "Step 3: Companies - import flow",
      "priority": 11,
      "passes": false,
      "description": "Implement paste/import companies",
      "steps": [
        "Show textarea for pasting company names (one per line)",
        "Parse pasted text into company objects",
        "Show parsed companies as editable list",
        "CSV upload button: parse CSV, map columns",
        "For each imported company, call /api/enrich-companies to fill details",
        "Show enrichment progress bar",
        "Add enriched companies to main DataTable",
        "Save to Supabase"
      ],
      "acceptance": "Can paste or upload companies, they get enriched and added to table"
    },
    {
      "id": "F12",
      "name": "Step 4: Contacts - company selection",
      "priority": 12,
      "passes": false,
      "description": "Select companies from table for contact search",
      "steps": [
        "Create src/components/wizard/ContactsStep.tsx",
        "Show list of companies from DataTable (checkbox per company)",
        "Select all / deselect all buttons",
        "Show count: 'X companies selected'",
        "Explain: 'Find contacts at selected companies'",
        "Next button proceeds to contact search"
      ],
      "acceptance": "Can select companies for contact search"
    },
    {
      "id": "F13",
      "name": "Step 4: Contacts - find contacts",
      "priority": 13,
      "passes": false,
      "description": "Search for contacts at selected companies",
      "steps": [
        "Add 'Find Contacts' button (requires Apollo API key)",
        "Check if API key exists, if not show ApiKeyModal",
        "Call /api/find-contacts-apollo with selected companies",
        "Show loading state with progress",
        "Display found contacts as selectable cards (name, title, company, LinkedIn)",
        "NO email shown yet (two-phase: contacts first, then emails)",
        "Select contacts to get emails for"
      ],
      "acceptance": "Contacts found and displayed without emails"
    },
    {
      "id": "F14",
      "name": "Step 4: Contacts - email enrichment",
      "priority": 14,
      "passes": false,
      "description": "Get emails for selected contacts with cost estimate",
      "steps": [
        "Show 'Find Emails' button with cost estimate",
        "Cost estimate: 'This will use ~X Apollo credits'",
        "Confirmation modal before proceeding",
        "Call Apollo API to get emails for selected contacts",
        "Update contacts in table with email addresses",
        "Save to Supabase contacts table",
        "Show success toast with count"
      ],
      "acceptance": "Emails fetched for selected contacts, cost shown beforehand"
    },
    {
      "id": "F15",
      "name": "Step 5: Emails - master prompt",
      "priority": 15,
      "passes": false,
      "description": "Master prompt for bulk email generation",
      "steps": [
        "Create src/components/wizard/EmailsStep.tsx",
        "Large textarea for master prompt at top",
        "Placeholder text explaining usage",
        "Save prompt button (persists to project.schema_config.masterPrompt)",
        "Warning banner: 'This will regenerate ALL emails'",
        "'Generate All Emails' button with confirmation modal",
        "Call /api/write-emails with master prompt and all contacts"
      ],
      "acceptance": "Master prompt saves and generates emails with warning"
    },
    {
      "id": "F16",
      "name": "Step 5: Emails - per-contact display",
      "priority": 16,
      "passes": false,
      "description": "Display generated emails per contact",
      "steps": [
        "List contacts with their generated emails below master prompt",
        "Each contact card shows: name, company, subject line, email body preview",
        "Copy Subject button (clipboard)",
        "Copy Body button (clipboard)",
        "Individual prompt textarea (collapsed by default, expand on click)",
        "Regenerate button for single email with individual prompt",
        "'Enter Conversation' button per contact"
      ],
      "acceptance": "Emails displayed per contact with copy buttons"
    },
    {
      "id": "F17",
      "name": "Conversation modal",
      "priority": 17,
      "passes": false,
      "description": "Modal for tracking email conversations",
      "steps": [
        "Create src/components/ConversationModal.tsx",
        "Modal opens on 'Enter Conversation' click",
        "Shows: contact name, company, initial email sent",
        "Textarea to paste their reply",
        "'Generate Response' button calls /api/draft-response",
        "Shows AI-generated response (copy button)",
        "'No Reply Yet' button generates follow-up email",
        "Conversation history displayed as thread",
        "Close button returns to emails step"
      ],
      "acceptance": "Can paste replies, generate responses, track conversation"
    },
    {
      "id": "F18",
      "name": "Integrate wizard with table",
      "priority": 18,
      "passes": false,
      "description": "Connect wizard actions to main data table",
      "steps": [
        "When companies added in Step 3, update DataTable rows",
        "When contacts found in Step 4, update DataTable rows (add contact to company row)",
        "When emails generated in Step 5, update DataTable rows (add email to contact)",
        "Status changes in table persist to Supabase",
        "Real-time sync between wizard and table state",
        "Table filters: show all, show without contacts, show without emails"
      ],
      "acceptance": "Wizard actions update table in real-time"
    },
    {
      "id": "F19",
      "name": "Add more companies button",
      "priority": 19,
      "passes": false,
      "description": "Incremental company addition",
      "steps": [
        "Add 'Add More Companies' button above DataTable",
        "Opens Companies step in wizard panel (expands it)",
        "New companies append to existing (don't replace)",
        "Duplicate detection by company name/domain",
        "Toast notification showing how many added"
      ],
      "acceptance": "Can add more companies anytime, they append to table"
    },
    {
      "id": "F20",
      "name": "Settings page with API keys",
      "priority": 20,
      "passes": false,
      "description": "API key management page",
      "steps": [
        "Create src/app/project/[id]/settings/page.tsx",
        "Link from project header (gear icon)",
        "Apollo API key input (required for contacts)",
        "Perplexity API key input (optional for enrichment)",
        "Hunter API key input (optional)",
        "Save keys to localStorage",
        "Status indicators: green checkmark if set, gray if not",
        "Links to get API keys from providers"
      ],
      "acceptance": "Can manage API keys, status shown in header"
    },
    {
      "id": "F21",
      "name": "Table sorting and filtering",
      "priority": 21,
      "passes": false,
      "description": "Add sort and filter to DataTable",
      "steps": [
        "Click column header to sort (asc/desc toggle)",
        "Sort indicator arrow in header",
        "Filter dropdown above table: All, Needs Contact, Needs Email, Needs Follow-up",
        "Search input to filter by company/contact name",
        "Clear filters button",
        "Persist sort/filter preference in localStorage"
      ],
      "acceptance": "Table is sortable and filterable"
    },
    {
      "id": "F22",
      "name": "Mobile responsive layout",
      "priority": 22,
      "passes": false,
      "description": "Make layout work on mobile",
      "steps": [
        "On mobile (<768px): stack wizard above table (not side by side)",
        "Wizard panel becomes collapsible header",
        "Table becomes horizontally scrollable",
        "Touch-friendly buttons and inputs",
        "Test on iPhone/Android viewport sizes"
      ],
      "acceptance": "App is usable on mobile devices"
    },
    {
      "id": "F23",
      "name": "Keyboard shortcuts",
      "priority": 23,
      "passes": false,
      "description": "Add keyboard shortcuts for power users",
      "steps": [
        "Cmd+S to save current step",
        "Cmd+1-5 to jump to wizard steps",
        "Escape to close modals",
        "Arrow keys to navigate table rows (when table focused)",
        "Enter to edit selected row",
        "Add keyboard shortcuts help modal (? key)"
      ],
      "acceptance": "Keyboard shortcuts work, help modal shows them"
    },
    {
      "id": "F24",
      "name": "Loading and error states",
      "priority": 24,
      "passes": false,
      "description": "Polish loading and error handling",
      "steps": [
        "Skeleton loaders for table while loading",
        "Spinner in wizard steps during API calls",
        "Error boundaries for component crashes",
        "Toast notifications for all errors",
        "Retry buttons for failed API calls",
        "Graceful degradation if Supabase unavailable"
      ],
      "acceptance": "All loading states shown, errors handled gracefully"
    },
    {
      "id": "F25",
      "name": "Final polish and build verification",
      "priority": 25,
      "passes": false,
      "description": "Final cleanup and verification",
      "steps": [
        "Run pnpm build - must pass with no errors",
        "Run pnpm lint - fix any warnings",
        "Test full flow: create project -> setup -> context -> companies -> contacts -> emails",
        "Verify data persists after page refresh",
        "Check all copy buttons work",
        "Verify 3-day follow-up highlighting works",
        "Remove any console.log statements",
        "Update progress.txt with completion notes"
      ],
      "acceptance": "Build passes, full flow works end-to-end"
    }
  ]
}
