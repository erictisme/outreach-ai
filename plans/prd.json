{
  "project": "outreach-v2",
  "description": "Contact flow fix - clear FREE vs PAID separation",
  "features": [
    {
      "id": "F49",
      "name": "Step 4 Phase A - Find Contacts UI",
      "priority": 49,
      "passes": true,
      "description": "ContactsStep shows selected companies + Find Contacts button (FREE)",
      "steps": [
        "ContactsStep.tsx: On load, show list of companies selected in Step 3",
        "Display selected companies in a compact list at top",
        "'Find Contacts' button prominently displayed",
        "When clicked, call /api/find-contacts-apollo for each company",
        "Show loading state while searching",
        "Display results in table: Name, Title, Company, LinkedIn",
        "NO email column at this phase - emails come later",
        "Persist found contacts to Supabase WITH apollo_id field"
      ],
      "acceptance": "Find Contacts shows contacts without emails"
    },
    {
      "id": "F50",
      "name": "Find Contacts API - FREE search",
      "priority": 50,
      "passes": true,
      "description": "Fix /api/find-contacts-apollo to use correct FREE endpoint",
      "steps": [
        "Endpoint: POST https://api.apollo.io/api/v1/mixed_people/api_search",
        "Request body: { q_organization_domains: domain (STRING), person_titles: [...], page: 1, per_page: 10 }",
        "Headers: { 'Content-Type': 'application/json', 'X-Api-Key': apiKey }",
        "Parse response.people array",
        "Extract for each person: id (this is apollo_id!), first_name, last_name, title, linkedin_url",
        "Handle last_name_obfuscated: use it if last_name is missing",
        "Return contacts with apollo_id included",
        "This endpoint is FREE - no credits used"
      ],
      "acceptance": "API returns contacts with apollo_id, no credits consumed"
    },
    {
      "id": "F51",
      "name": "Step 4 Phase B - Email Enrichment UI",
      "priority": 51,
      "passes": true,
      "description": "Select contacts, click Get Emails (PAID), shows cost warning",
      "steps": [
        "After contacts displayed, show checkbox column as FIRST column",
        "Header checkbox for select all / deselect all",
        "Track selectedContactIds in state",
        "Show selection count: 'X of Y selected'",
        "'Get Emails (X selected)' button - only enabled when contacts selected",
        "On click, show confirmation modal: 'This will use approximately X credits'",
        "On confirm, call /api/enrich-contacts-email with selected apollo_ids",
        "After enrichment, update contacts table to show email column"
      ],
      "acceptance": "Can select contacts and trigger paid email enrichment"
    },
    {
      "id": "F52",
      "name": "Email Enrichment API - PAID bulk_match",
      "priority": 52,
      "passes": true,
      "description": "New /api/enrich-contacts-email using Apollo bulk_match",
      "steps": [
        "Create or update /api/enrich-contacts-email/route.ts",
        "Accept: { contactIds: string[], apolloIds: string[], apiKey: string }",
        "Endpoint: POST https://api.apollo.io/api/v1/people/bulk_match",
        "Request body: { details: apolloIds.map(id => ({id})), reveal_personal_emails: false }",
        "Headers: { 'Content-Type': 'application/json', 'X-Api-Key': apiKey }",
        "Parse response.matches array",
        "Extract email from each match",
        "Return map of apolloId -> email",
        "This endpoint COSTS CREDITS"
      ],
      "acceptance": "API returns emails for given apollo_ids"
    },
    {
      "id": "F53",
      "name": "Update Contact type with apollo_id",
      "priority": 53,
      "passes": true,
      "description": "Ensure Contact type and Supabase schema support apollo_id",
      "steps": [
        "In src/types/index.ts: Add apollo_id?: string to Contact/Person type",
        "Check Supabase contacts table - add apollo_id column if missing",
        "When saving contacts, include apollo_id",
        "When loading contacts, load apollo_id",
        "When enriching, use apollo_id to call bulk_match"
      ],
      "acceptance": "apollo_id stored and retrieved correctly"
    },
    {
      "id": "F54",
      "name": "Final verification - two-phase contact flow",
      "priority": 54,
      "passes": false,
      "description": "Test complete flow: Find (free) → Select → Enrich (paid)",
      "steps": [
        "pnpm build passes",
        "Step 3: Select companies, go to Step 4",
        "Step 4: Click Find Contacts → contacts appear (no emails)",
        "Select some contacts with checkboxes",
        "Click 'Get Emails' → cost warning modal",
        "Confirm → emails appear in table",
        "Verify apollo_id stored in Supabase",
        "Refresh page → data persists"
      ],
      "acceptance": "Full two-phase contact flow works"
    }
  ]
}
